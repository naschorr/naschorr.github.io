import{B as D,E as M,I as A,V as R,W as I,a as y,b as L,c as _,da as F,e as g,f as C,g as S,h as b,k as z,m as O,o as T,p as G,s as w,t as m,y as u}from"./chunk-NJWKMIDL.js";import{a as E,b as f,d}from"./chunk-F6SUT7E5.js";var v=class{constructor(){this.subject=new g(1),this.subscriptions=new y}doFilter(e){this.subject.next(e)}dispose(){this.subscriptions.unsubscribe()}notEmpty(e,a){this.subscriptions.add(this.subject.subscribe(t=>{if(t[e]){let i=t[e].currentValue;i!=null&&a(i)}}))}has(e,a){this.subscriptions.add(this.subject.subscribe(t=>{if(t[e]){let i=t[e].currentValue;a(i)}}))}notFirst(e,a){this.subscriptions.add(this.subject.subscribe(t=>{if(t[e]&&!t[e].isFirstChange()){let i=t[e].currentValue;a(i)}}))}notFirstAndEmpty(e,a){this.subscriptions.add(this.subject.subscribe(t=>{if(t[e]&&!t[e].isFirstChange()){let i=t[e].currentValue;i!=null&&a(i)}}))}},P=new z("NGX_ECHARTS_CONFIG"),N=(()=>{let e=class e{constructor(t,i,s){this.el=i,this.ngZone=s,this.options=null,this.theme=null,this.initOpts=null,this.merge=null,this.autoResize=!0,this.loading=!1,this.loadingType="default",this.loadingOpts=null,this.chartInit=new m,this.optionsError=new m,this.chartClick=this.createLazyEvent("click"),this.chartDblClick=this.createLazyEvent("dblclick"),this.chartMouseDown=this.createLazyEvent("mousedown"),this.chartMouseMove=this.createLazyEvent("mousemove"),this.chartMouseUp=this.createLazyEvent("mouseup"),this.chartMouseOver=this.createLazyEvent("mouseover"),this.chartMouseOut=this.createLazyEvent("mouseout"),this.chartGlobalOut=this.createLazyEvent("globalout"),this.chartContextMenu=this.createLazyEvent("contextmenu"),this.chartHighlight=this.createLazyEvent("highlight"),this.chartDownplay=this.createLazyEvent("downplay"),this.chartSelectChanged=this.createLazyEvent("selectchanged"),this.chartLegendSelectChanged=this.createLazyEvent("legendselectchanged"),this.chartLegendSelected=this.createLazyEvent("legendselected"),this.chartLegendUnselected=this.createLazyEvent("legendunselected"),this.chartLegendLegendSelectAll=this.createLazyEvent("legendselectall"),this.chartLegendLegendInverseSelect=this.createLazyEvent("legendinverseselect"),this.chartLegendScroll=this.createLazyEvent("legendscroll"),this.chartDataZoom=this.createLazyEvent("datazoom"),this.chartDataRangeSelected=this.createLazyEvent("datarangeselected"),this.chartGraphRoam=this.createLazyEvent("graphroam"),this.chartGeoRoam=this.createLazyEvent("georoam"),this.chartTreeRoam=this.createLazyEvent("treeroam"),this.chartTimelineChanged=this.createLazyEvent("timelinechanged"),this.chartTimelinePlayChanged=this.createLazyEvent("timelineplaychanged"),this.chartRestore=this.createLazyEvent("restore"),this.chartDataViewChanged=this.createLazyEvent("dataviewchanged"),this.chartMagicTypeChanged=this.createLazyEvent("magictypechanged"),this.chartGeoSelectChanged=this.createLazyEvent("geoselectchanged"),this.chartGeoSelected=this.createLazyEvent("geoselected"),this.chartGeoUnselected=this.createLazyEvent("geounselected"),this.chartAxisAreaSelected=this.createLazyEvent("axisareaselected"),this.chartBrush=this.createLazyEvent("brush"),this.chartBrushEnd=this.createLazyEvent("brushend"),this.chartBrushSelected=this.createLazyEvent("brushselected"),this.chartGlobalCursorTaken=this.createLazyEvent("globalcursortaken"),this.chartRendered=this.createLazyEvent("rendered"),this.chartFinished=this.createLazyEvent("finished"),this.animationFrameID=null,this.chart$=new g(1),this.resize$=new _,this.changeFilter=new v,this.resizeObFired=!1,this.echarts=t.echarts,this.theme=t.theme||null}ngOnChanges(t){this.changeFilter.doFilter(t)}ngOnInit(){if(!window.ResizeObserver)throw new Error("please install a polyfill for ResizeObserver");this.resizeSub=this.resize$.pipe(b(100,C,{leading:!1,trailing:!0})).subscribe(()=>this.resize()),this.autoResize&&(this.resizeOb=this.ngZone.runOutsideAngular(()=>new window.ResizeObserver(t=>{for(let i of t)i.target===this.el.nativeElement&&(this.resizeObFired?this.animationFrameID=window.requestAnimationFrame(()=>{this.resize$.next()}):this.resizeObFired=!0)})),this.resizeOb.observe(this.el.nativeElement)),this.changeFilter.notFirstAndEmpty("options",t=>this.onOptionsChange(t)),this.changeFilter.notFirstAndEmpty("merge",t=>this.setOption(t)),this.changeFilter.has("loading",t=>this.toggleLoading(!!t)),this.changeFilter.notFirst("theme",()=>this.refreshChart())}ngOnDestroy(){window.clearTimeout(this.initChartTimer),this.resizeSub&&this.resizeSub.unsubscribe(),this.animationFrameID&&window.cancelAnimationFrame(this.animationFrameID),this.resizeOb&&this.resizeOb.unobserve(this.el.nativeElement),this.loadingSub&&this.loadingSub.unsubscribe(),this.changeFilter.dispose(),this.dispose()}ngAfterViewInit(){this.initChartTimer=window.setTimeout(()=>this.initChart())}dispose(){this.chart&&(this.chart.isDisposed()||this.chart.dispose(),this.chart=null)}resize(){this.chart&&this.chart.resize()}toggleLoading(t){this.chart?t?this.chart.showLoading(this.loadingType,this.loadingOpts):this.chart.hideLoading():this.loadingSub=this.chart$.subscribe(i=>t?i.showLoading(this.loadingType,this.loadingOpts):i.hideLoading())}setOption(t,i){if(this.chart)try{this.chart.setOption(t,i)}catch(s){console.error(s),this.optionsError.emit(s)}}refreshChart(){return d(this,null,function*(){this.dispose(),yield this.initChart()})}createChart(){let t=this.el.nativeElement;if(window&&window.getComputedStyle){let i=window.getComputedStyle(t,null).getPropertyValue("height");(!i||i==="0px")&&(!t.style.height||t.style.height==="0px")&&(t.style.height="400px")}return this.ngZone.runOutsideAngular(()=>(typeof this.echarts=="function"?this.echarts:()=>Promise.resolve(this.echarts))().then(({init:s})=>s(t,this.theme,this.initOpts)))}initChart(){return d(this,null,function*(){yield this.onOptionsChange(this.options),this.merge&&this.chart&&this.setOption(this.merge)})}onOptionsChange(t){return d(this,null,function*(){t&&(this.chart?this.setOption(this.options,!0):(this.chart=yield this.createChart(),this.chart$.next(this.chart),this.chartInit.emit(this.chart),this.setOption(this.options,!0)))})}createLazyEvent(t){return this.chartInit.pipe(S(i=>new L(s=>(i.on(t,o=>this.ngZone.run(()=>s.next(o))),()=>{this.chart&&(this.chart.isDisposed()||i.off(t))}))))}};e.\u0275fac=function(i){return new(i||e)(u(P),u(w),u(D))},e.\u0275dir=T({type:e,selectors:[["echarts"],["","echarts",""]],inputs:{options:"options",theme:"theme",initOpts:"initOpts",merge:"merge",autoResize:"autoResize",loading:"loading",loadingType:"loadingType",loadingOpts:"loadingOpts"},outputs:{chartInit:"chartInit",optionsError:"optionsError",chartClick:"chartClick",chartDblClick:"chartDblClick",chartMouseDown:"chartMouseDown",chartMouseMove:"chartMouseMove",chartMouseUp:"chartMouseUp",chartMouseOver:"chartMouseOver",chartMouseOut:"chartMouseOut",chartGlobalOut:"chartGlobalOut",chartContextMenu:"chartContextMenu",chartHighlight:"chartHighlight",chartDownplay:"chartDownplay",chartSelectChanged:"chartSelectChanged",chartLegendSelectChanged:"chartLegendSelectChanged",chartLegendSelected:"chartLegendSelected",chartLegendUnselected:"chartLegendUnselected",chartLegendLegendSelectAll:"chartLegendLegendSelectAll",chartLegendLegendInverseSelect:"chartLegendLegendInverseSelect",chartLegendScroll:"chartLegendScroll",chartDataZoom:"chartDataZoom",chartDataRangeSelected:"chartDataRangeSelected",chartGraphRoam:"chartGraphRoam",chartGeoRoam:"chartGeoRoam",chartTreeRoam:"chartTreeRoam",chartTimelineChanged:"chartTimelineChanged",chartTimelinePlayChanged:"chartTimelinePlayChanged",chartRestore:"chartRestore",chartDataViewChanged:"chartDataViewChanged",chartMagicTypeChanged:"chartMagicTypeChanged",chartGeoSelectChanged:"chartGeoSelectChanged",chartGeoSelected:"chartGeoSelected",chartGeoUnselected:"chartGeoUnselected",chartAxisAreaSelected:"chartAxisAreaSelected",chartBrush:"chartBrush",chartBrushEnd:"chartBrushEnd",chartBrushSelected:"chartBrushSelected",chartGlobalCursorTaken:"chartGlobalCursorTaken",chartRendered:"chartRendered",chartFinished:"chartFinished"},exportAs:["echarts"],standalone:!0,features:[G]});let r=e;return r})(),x=(r={})=>({provide:P,useFactory:()=>f(E({},r),{echarts:()=>import("./chunk-7KCIV7PF.js")})});var p=class{constructor(e,a,t){this._proportionalGain=e,this._integralGain=a,this._derivativeGain=t,this._setPoint=0,this._integralValue=0,this._previousError=0,this._previousTimestamp=null}get proportionalGain(){return this._proportionalGain}get integralGain(){return this._integralGain}get derivativeGain(){return this._derivativeGain}_proportional(e){return this.proportionalGain*e}_integral(e,a){return this._integralValue=this._integralValue+e*a,this.integralGain*this._integralValue}_derivative(e,a){let t=(e-this._previousError)/a;return this.derivativeGain*t}runLoop(e,a){let t=this._setPoint-e,i=a||new Date().getTime()/1e3,s=0,o=this._proportional(t);if(s+=o,this._previousTimestamp){let h=i-this._previousTimestamp,l=this._integral(t,h);s+=l;let n=this._derivative(t,h);s+=n}return this._previousError=t,this._previousTimestamp=i,s}adjustSetPoint(e){this._setPoint=e}};var c=class{constructor(e,a,t,i,s,o,h){this._name=e,this._proportionalGain=a,this._integralGain=t,this._derivativeGain=i,this._maxDataLength=o??256,this._outputTransformer=h,this._pid=new p(this.proportionalGain,this.integralGain,this.derivativeGain),this._data=[],this._processVariable=s}get name(){return this._name}get proportionalGain(){return this._proportionalGain}get integralGain(){return this._integralGain}get derivativeGain(){return this._derivativeGain}get data(){return this._data.slice()}initializeSetPoint(e,a){this.adjustSetPoint(e),this._storeDatum(a)}adjustSetPoint(e){this._pid.adjustSetPoint(e)}_storeDatum(e){this._data.push(e),this._data.length>this._maxDataLength&&this._data.shift()}runLoop(){let e=this._pid.runLoop(this._processVariable);return this._outputTransformer&&(e=this._outputTransformer(e)),e+=this._processVariable,this._storeDatum(e),this._processVariable=e,e}};var j=(()=>{let e=class e{constructor(){this.pidContainers=[],this.TIME_INTERVAL_SECONDS=1,this.MAX_CHANGES_PER_SECOND=10,this.MAX_GRAPHED_ELEMENTS=45,this.ITERATIONS_BEFORE_CHANGING_SET_POINT=15;let t=Math.random()*5;this.pidContainers=[new c("(1, 1, 1)",1,1,1,t,this.MAX_GRAPHED_ELEMENTS,this.normalizePidOutput.bind(this)),new c("(2, 1, 1)",2,1,1,t,this.MAX_GRAPHED_ELEMENTS,this.normalizePidOutput.bind(this)),new c("(1, 2, 1)",1,2,1,t,this.MAX_GRAPHED_ELEMENTS,this.normalizePidOutput.bind(this)),new c("(1, 1, 2)",1,1,2,t,this.MAX_GRAPHED_ELEMENTS,this.normalizePidOutput.bind(this))]}generateSetPoint(){return Math.random()*5}normalizePidOutput(t){let i=this.TIME_INTERVAL_SECONDS*this.MAX_CHANGES_PER_SECOND,s=t/i;return Math.min(i,Math.max(-i,s))}ngOnInit(){let t=[],i=[],s=this.generateSetPoint();for(let h of this.pidContainers)h.adjustSetPoint(s);let o=0;console.log("START"),setInterval(()=>{t.push(`${s.toFixed(3)}`),i.push(s);for(let n of this.pidContainers)n.runLoop();if(t.length>this.MAX_GRAPHED_ELEMENTS&&(t.shift(),i.shift()),o%this.ITERATIONS_BEFORE_CHANGING_SET_POINT===0){s=this.generateSetPoint();for(let n of this.pidContainers)n.adjustSetPoint(s)}o+=1;let h=["set_point"],l=[{name:"set_point",type:"line",data:i,animationDelay:n=>n*0,colorBy:"series",symbol:"none",universalTransition:!0}];for(let n of this.pidContainers)h.push(n.name),l.push({name:n.name,type:"line",data:n.data,animationDelay:V=>V*0,colorBy:"series",symbol:"none",universalTransition:!0});this.options={legend:{data:h,align:"left"},tooltip:{},xAxis:{data:t,silent:!0,splitLine:{show:!1}},yAxis:{},series:l,animationEasing:"linear",animationDelayUpdate:0}},this.TIME_INTERVAL_SECONDS*1e3)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=O({type:e,selectors:[["pid-playground"]],standalone:!0,features:[R([x()]),I],decls:1,vars:1,consts:[["echarts","",1,"demo-chart",3,"options"]],template:function(i,s){i&1&&A(0,"div",0),i&2&&M("options",s.options)},dependencies:[F,N]});let r=e;return r})();var ot=[{path:"",component:j}];export{ot as default};
