import{B as m,C as G,D as w,J as D,S as M,T as A,a as E,b as f,ba as R,c as y,e as g,f as L,g as _,h as C,k as S,m as b,o as z,p as O,v as T,z as u}from"./chunk-IY5UK5EP.js";import{d}from"./chunk-JMZ7DUBM.js";var v=class{constructor(){this.subject=new g(1),this.subscriptions=new E}doFilter(e){this.subject.next(e)}dispose(){this.subscriptions.unsubscribe()}notEmpty(e,s){this.subscriptions.add(this.subject.subscribe(t=>{if(t[e]){let i=t[e].currentValue;i!=null&&s(i)}}))}has(e,s){this.subscriptions.add(this.subject.subscribe(t=>{if(t[e]){let i=t[e].currentValue;s(i)}}))}notFirst(e,s){this.subscriptions.add(this.subject.subscribe(t=>{if(t[e]&&!t[e].isFirstChange()){let i=t[e].currentValue;s(i)}}))}notFirstAndEmpty(e,s){this.subscriptions.add(this.subject.subscribe(t=>{if(t[e]&&!t[e].isFirstChange()){let i=t[e].currentValue;i!=null&&s(i)}}))}},I=new S("NGX_ECHARTS_CONFIG"),P=(()=>{let e=class e{constructor(t,i,a){this.el=i,this.ngZone=a,this.options=null,this.theme=null,this.initOpts=null,this.merge=null,this.autoResize=!0,this.loading=!1,this.loadingType="default",this.loadingOpts=null,this.chartInit=new m,this.optionsError=new m,this.chartClick=this.createLazyEvent("click"),this.chartDblClick=this.createLazyEvent("dblclick"),this.chartMouseDown=this.createLazyEvent("mousedown"),this.chartMouseMove=this.createLazyEvent("mousemove"),this.chartMouseUp=this.createLazyEvent("mouseup"),this.chartMouseOver=this.createLazyEvent("mouseover"),this.chartMouseOut=this.createLazyEvent("mouseout"),this.chartGlobalOut=this.createLazyEvent("globalout"),this.chartContextMenu=this.createLazyEvent("contextmenu"),this.chartHighlight=this.createLazyEvent("highlight"),this.chartDownplay=this.createLazyEvent("downplay"),this.chartSelectChanged=this.createLazyEvent("selectchanged"),this.chartLegendSelectChanged=this.createLazyEvent("legendselectchanged"),this.chartLegendSelected=this.createLazyEvent("legendselected"),this.chartLegendUnselected=this.createLazyEvent("legendunselected"),this.chartLegendLegendSelectAll=this.createLazyEvent("legendselectall"),this.chartLegendLegendInverseSelect=this.createLazyEvent("legendinverseselect"),this.chartLegendScroll=this.createLazyEvent("legendscroll"),this.chartDataZoom=this.createLazyEvent("datazoom"),this.chartDataRangeSelected=this.createLazyEvent("datarangeselected"),this.chartGraphRoam=this.createLazyEvent("graphroam"),this.chartGeoRoam=this.createLazyEvent("georoam"),this.chartTreeRoam=this.createLazyEvent("treeroam"),this.chartTimelineChanged=this.createLazyEvent("timelinechanged"),this.chartTimelinePlayChanged=this.createLazyEvent("timelineplaychanged"),this.chartRestore=this.createLazyEvent("restore"),this.chartDataViewChanged=this.createLazyEvent("dataviewchanged"),this.chartMagicTypeChanged=this.createLazyEvent("magictypechanged"),this.chartGeoSelectChanged=this.createLazyEvent("geoselectchanged"),this.chartGeoSelected=this.createLazyEvent("geoselected"),this.chartGeoUnselected=this.createLazyEvent("geounselected"),this.chartAxisAreaSelected=this.createLazyEvent("axisareaselected"),this.chartBrush=this.createLazyEvent("brush"),this.chartBrushEnd=this.createLazyEvent("brushend"),this.chartBrushSelected=this.createLazyEvent("brushselected"),this.chartGlobalCursorTaken=this.createLazyEvent("globalcursortaken"),this.chartRendered=this.createLazyEvent("rendered"),this.chartFinished=this.createLazyEvent("finished"),this.animationFrameID=null,this.chart$=new g(1),this.resize$=new y,this.changeFilter=new v,this.echarts=t.echarts}ngOnChanges(t){this.changeFilter.doFilter(t)}ngOnInit(){if(!window.ResizeObserver)throw new Error("please install a polyfill for ResizeObserver");this.resizeSub=this.resize$.pipe(C(100,L,{leading:!1,trailing:!0})).subscribe(()=>this.resize()),this.autoResize&&(this.resizeOb=this.ngZone.runOutsideAngular(()=>new window.ResizeObserver(()=>{this.animationFrameID=window.requestAnimationFrame(()=>this.resize$.next())})),this.resizeOb.observe(this.el.nativeElement)),this.changeFilter.notFirstAndEmpty("options",t=>this.onOptionsChange(t)),this.changeFilter.notFirstAndEmpty("merge",t=>this.setOption(t)),this.changeFilter.has("loading",t=>this.toggleLoading(!!t)),this.changeFilter.notFirst("theme",()=>this.refreshChart())}ngOnDestroy(){window.clearTimeout(this.initChartTimer),this.resizeSub&&this.resizeSub.unsubscribe(),this.animationFrameID&&window.cancelAnimationFrame(this.animationFrameID),this.resizeOb&&this.resizeOb.unobserve(this.el.nativeElement),this.loadingSub&&this.loadingSub.unsubscribe(),this.changeFilter.dispose(),this.dispose()}ngAfterViewInit(){this.initChartTimer=window.setTimeout(()=>this.initChart())}dispose(){this.chart&&(this.chart.isDisposed()||this.chart.dispose(),this.chart=null)}resize(){this.chart&&this.chart.resize()}toggleLoading(t){this.chart?t?this.chart.showLoading(this.loadingType,this.loadingOpts):this.chart.hideLoading():this.loadingSub=this.chart$.subscribe(i=>t?i.showLoading(this.loadingType,this.loadingOpts):i.hideLoading())}setOption(t,i){if(this.chart)try{this.chart.setOption(t,i)}catch(a){console.error(a),this.optionsError.emit(a)}}refreshChart(){return d(this,null,function*(){this.dispose(),yield this.initChart()})}createChart(){let t=this.el.nativeElement;if(window&&window.getComputedStyle){let i=window.getComputedStyle(t,null).getPropertyValue("height");(!i||i==="0px")&&(!t.style.height||t.style.height==="0px")&&(t.style.height="400px")}return this.ngZone.runOutsideAngular(()=>(typeof this.echarts=="function"?this.echarts:()=>Promise.resolve(this.echarts))().then(({init:a})=>a(t,this.theme,this.initOpts)))}initChart(){return d(this,null,function*(){yield this.onOptionsChange(this.options),this.merge&&this.chart&&this.setOption(this.merge)})}onOptionsChange(t){return d(this,null,function*(){t&&(this.chart?this.setOption(this.options,!0):(this.chart=yield this.createChart(),this.chart$.next(this.chart),this.chartInit.emit(this.chart),this.setOption(this.options,!0)))})}createLazyEvent(t){return this.chartInit.pipe(_(i=>new f(a=>(i.on(t,o=>this.ngZone.run(()=>a.next(o))),()=>{this.chart&&(this.chart.isDisposed()||i.off(t))}))))}};e.\u0275fac=function(i){return new(i||e)(u(I),u(T),u(G))},e.\u0275dir=z({type:e,selectors:[["echarts"],["","echarts",""]],inputs:{options:"options",theme:"theme",initOpts:"initOpts",merge:"merge",autoResize:"autoResize",loading:"loading",loadingType:"loadingType",loadingOpts:"loadingOpts"},outputs:{chartInit:"chartInit",optionsError:"optionsError",chartClick:"chartClick",chartDblClick:"chartDblClick",chartMouseDown:"chartMouseDown",chartMouseMove:"chartMouseMove",chartMouseUp:"chartMouseUp",chartMouseOver:"chartMouseOver",chartMouseOut:"chartMouseOut",chartGlobalOut:"chartGlobalOut",chartContextMenu:"chartContextMenu",chartHighlight:"chartHighlight",chartDownplay:"chartDownplay",chartSelectChanged:"chartSelectChanged",chartLegendSelectChanged:"chartLegendSelectChanged",chartLegendSelected:"chartLegendSelected",chartLegendUnselected:"chartLegendUnselected",chartLegendLegendSelectAll:"chartLegendLegendSelectAll",chartLegendLegendInverseSelect:"chartLegendLegendInverseSelect",chartLegendScroll:"chartLegendScroll",chartDataZoom:"chartDataZoom",chartDataRangeSelected:"chartDataRangeSelected",chartGraphRoam:"chartGraphRoam",chartGeoRoam:"chartGeoRoam",chartTreeRoam:"chartTreeRoam",chartTimelineChanged:"chartTimelineChanged",chartTimelinePlayChanged:"chartTimelinePlayChanged",chartRestore:"chartRestore",chartDataViewChanged:"chartDataViewChanged",chartMagicTypeChanged:"chartMagicTypeChanged",chartGeoSelectChanged:"chartGeoSelectChanged",chartGeoSelected:"chartGeoSelected",chartGeoUnselected:"chartGeoUnselected",chartAxisAreaSelected:"chartAxisAreaSelected",chartBrush:"chartBrush",chartBrushEnd:"chartBrushEnd",chartBrushSelected:"chartBrushSelected",chartGlobalCursorTaken:"chartGlobalCursorTaken",chartRendered:"chartRendered",chartFinished:"chartFinished"},exportAs:["echarts"],standalone:!0,features:[O]});let n=e;return n})(),F=()=>({provide:I,useFactory:()=>({echarts:()=>import("./chunk-Y6WG2NLY.js")})});var p=class{constructor(e,s,t){this._proportionalGain=e,this._integralGain=s,this._derivativeGain=t,this._setPoint=0,this._integralValue=0,this._previousError=0,this._previousTimestamp=null}get proportionalGain(){return this._proportionalGain}get integralGain(){return this._integralGain}get derivativeGain(){return this._derivativeGain}_proportional(e){return this.proportionalGain*e}_integral(e,s){return this._integralValue=this._integralValue+e*s,this.integralGain*this._integralValue}_derivative(e,s){let t=(e-this._previousError)/s;return this.derivativeGain*t}runLoop(e,s){let t=this._setPoint-e,i=s||new Date().getTime()/1e3,a=0,o=this._proportional(t);if(a+=o,this._previousTimestamp){let h=i-this._previousTimestamp,l=this._integral(t,h);a+=l;let r=this._derivative(t,h);a+=r}return this._previousError=t,this._previousTimestamp=i,a}adjustSetPoint(e){this._setPoint=e}};var c=class{constructor(e,s,t,i,a,o,h){this._name=e,this._proportionalGain=s,this._integralGain=t,this._derivativeGain=i,this._maxDataLength=o??256,this._outputTransformer=h,this._pid=new p(this.proportionalGain,this.integralGain,this.derivativeGain),this._data=[],this._processVariable=a}get name(){return this._name}get proportionalGain(){return this._proportionalGain}get integralGain(){return this._integralGain}get derivativeGain(){return this._derivativeGain}get data(){return this._data.slice()}initializeSetPoint(e,s){this.adjustSetPoint(e),this._storeDatum(s)}adjustSetPoint(e){this._pid.adjustSetPoint(e)}_storeDatum(e){this._data.push(e),this._data.length>this._maxDataLength&&this._data.shift()}runLoop(){let e=this._pid.runLoop(this._processVariable);return this._outputTransformer&&(e=this._outputTransformer(e)),e+=this._processVariable,this._storeDatum(e),this._processVariable=e,e}};var N=(()=>{let e=class e{constructor(){this.pidContainers=[],this.TIME_INTERVAL_SECONDS=1,this.MAX_CHANGES_PER_SECOND=10,this.MAX_GRAPHED_ELEMENTS=45,this.ITERATIONS_BEFORE_CHANGING_SET_POINT=15;let t=Math.random()*5;this.pidContainers=[new c("(1, 1, 1)",1,1,1,t,this.MAX_GRAPHED_ELEMENTS,this.normalizePidOutput.bind(this)),new c("(2, 1, 1)",2,1,1,t,this.MAX_GRAPHED_ELEMENTS,this.normalizePidOutput.bind(this)),new c("(1, 2, 1)",1,2,1,t,this.MAX_GRAPHED_ELEMENTS,this.normalizePidOutput.bind(this)),new c("(1, 1, 2)",1,1,2,t,this.MAX_GRAPHED_ELEMENTS,this.normalizePidOutput.bind(this))]}generateSetPoint(){return Math.random()*5}normalizePidOutput(t){let i=this.TIME_INTERVAL_SECONDS*this.MAX_CHANGES_PER_SECOND,a=t/i;return Math.min(i,Math.max(-i,a))}ngOnInit(){let t=[],i=[],a=this.generateSetPoint();for(let h of this.pidContainers)h.adjustSetPoint(a);let o=0;console.log("START"),setInterval(()=>{t.push(`${a.toFixed(3)}`),i.push(a);for(let r of this.pidContainers)r.runLoop();if(t.length>this.MAX_GRAPHED_ELEMENTS&&(t.shift(),i.shift()),o%this.ITERATIONS_BEFORE_CHANGING_SET_POINT===0){a=this.generateSetPoint();for(let r of this.pidContainers)r.adjustSetPoint(a)}o+=1;let h=["set_point"],l=[{name:"set_point",type:"line",data:i,animationDelay:r=>r*0,colorBy:"series",symbol:"none",universalTransition:!0}];for(let r of this.pidContainers)h.push(r.name),l.push({name:r.name,type:"line",data:r.data,animationDelay:x=>x*0,colorBy:"series",symbol:"none",universalTransition:!0});this.options={legend:{data:h,align:"left"},tooltip:{},xAxis:{data:t,silent:!0,splitLine:{show:!1}},yAxis:{},series:l,animationEasing:"linear",animationDelayUpdate:0}},this.TIME_INTERVAL_SECONDS*1e3)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=b({type:e,selectors:[["pid-playground"]],standalone:!0,features:[M([F()]),A],decls:1,vars:1,consts:[["echarts","",1,"demo-chart",3,"options"]],template:function(i,a){i&1&&D(0,"div",0),i&2&&w("options",a.options)},dependencies:[R,P]});let n=e;return n})();var nt=[{path:"",component:N}];export{nt as default};
